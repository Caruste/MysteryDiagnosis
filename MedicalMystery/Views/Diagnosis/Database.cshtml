<div class="col-lg-8" style="margin-top: 20px">
    <table class="table table-bordered" id="database_area">
        <thead>
            <tr>
                <th><h2 style="text-align:center;">Disease</h2></th>
                <th><h2 style="text-align:center;">Symptoms</h2></th>
            </tr>
        </thead>
        <tbody id="database"></tbody>
    </table>
</div>


<div style="margin-top: 20px" class="col-lg-4">
    <table class="table table-bordered" id="text_area">
        <tr>
            <th>
                <h2 style="text-align:center;">Input the database here</h2>
            </th>
        </tr>
        <tr>
            <th style="text-align:center">
                <textarea id="inputDiseases" style="resize:none"></textarea>
            </th>
        </tr>
        <tr>
            <th>
                <input type="button" name="submit" id="submit" class="btn btn-success" value="Submit" />
                <input type="button" name="clear" id="clear" class="btn btn-danger" value="Clear database" />
            </th>
        </tr>
    </table>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {

            getDatabase();

            changeTextArea();

            window.addEventListener('resize', function () {
                changeTextArea();
            });

            $('#submit').click(function () {
                var lines = [];
                $.each($('#inputDiseases').val().split(/\n/), function (i, line) {
                    if (line) lines.push(line);
                });
                $.ajax({
                    type: "POST",
                    url: "/api/Diseases",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(lines),
                    dataType: "json",
                    success: function (data) {
                        location.reload(true);
                    }
                });
            });
            $('#clear').click(function () {
                $.ajax({
                    type: "DELETE",
                    url: "/api/Diseases",
                    success: function (data) {
                        location.reload(true);
                    }
                });
            }); 
        });

        function changeTextArea() {
            var boxWidth = $('#database_area').width() / 2;
            if ($('#database_area').width() == $('#text_area').width()) boxWidth = $('#database_area').width();
            $('#inputDiseases').css("width", boxWidth/1.1);
            $('#inputDiseases').css("height", boxWidth/2);
        }
        
        function getDatabase() {
            $.ajax({
                type: "GET",
                url: "/api/Diseases",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {

                    $("#disease").remove();
                    var ForAppending = '';

                    $.each(data, function (i, v) {
                        ForAppending += ('<tr class="disease"><th>' + v.name + '</th>')
                        ForAppending += ('<th>');

                        $.each(v.symptoms, function (i, s) {
                            ForAppending += ('<p>' + s + '</p>');
                        });

                        ForAppending += ('</th></tr>');
                        $('#database').append(ForAppending);
                        ForAppending = '';
                    });
                }
            });
        }
    </script>
}